# Force HTTPS on all traffic
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Security and PWA-related headers
<IfModule mod_headers.c>
  # Allow camera/microphone in this origin (needed for getUserMedia in some iframe scenarios)
  Header always set Permissions-Policy "camera=(self), microphone=(self)"
  # Safer content type handling
  Header always set X-Content-Type-Options "nosniff"
  # Reasonable referrer policy for mixed assets
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Proper MIME type for web manifests
AddType application/manifest+json .webmanifest .manifest

# Service Worker scope and caching hints
<Files "sw.js">
  <IfModule mod_headers.c>
    Header set Service-Worker-Allowed "/"
    Header set Cache-Control "no-cache"
  </IfModule>
</Files>