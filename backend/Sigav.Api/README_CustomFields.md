# Sistema de Campos Personalizables - SIGAV

## üéØ **¬øQu√© es el Sistema de Campos Personalizables?**

Es un sistema flexible que permite a **cada empresa** agregar sus propios campos personalizados a cualquier entidad del sistema (Busetas, Empleados, Checklists, etc.) sin necesidad de modificar el c√≥digo base.

## üèóÔ∏è **Arquitectura del Sistema**

### **Entidades Principales:**

1. **`CustomField`** - Define un campo personalizable
2. **`CustomFieldValue`** - Almacena el valor de un campo personalizable para una entidad espec√≠fica
3. **`Empresa`** - Cada empresa tiene sus propios campos personalizados

### **Relaciones:**
```
Empresa (1) ‚Üê‚Üí (N) CustomField
CustomField (1) ‚Üê‚Üí (N) CustomFieldValue
Entidad (Buseta/Usuario/etc.) (1) ‚Üê‚Üí (N) CustomFieldValue
```

## üìù **Tipos de Campos Soportados**

| Tipo | Descripci√≥n | Ejemplo |
|------|-------------|---------|
| **Text** | Campo de texto libre | "Color preferido del conductor" |
| **Number** | Campo num√©rico | "A√±os de experiencia" |
| **Date** | Campo de fecha | "Fecha de √∫ltima revisi√≥n m√©dica" |
| **Boolean** | Campo verdadero/falso | "¬øTiene licencia especial?" |
| **Select** | Campo de selecci√≥n m√∫ltiple | "Tipo de combustible preferido" |

## üöÄ **C√≥mo Usar el Sistema**

### **1. Crear una Empresa**
```json
POST /api/Empresas
{
  "nombre": "Transportes ABC",
  "nit": "12345678-9",
  "direccion": "Calle 123 #45-67",
  "telefono": "300-123-4567",
  "email": "info@transportesabc.com"
}
```

### **2. Agregar Campos Personalizados a Busetas**
```json
POST /api/CustomFields
{
  "nombre": "Tipo de Ruta",
  "descripcion": "Tipo de ruta que puede manejar la buseta",
  "tipo": "Select",
  "opciones": "Urbana|Interurbana|Rural|Mixta",
  "entidad": "Buseta",
  "empresaId": 1,
  "requerido": true,
  "orden": 1
}
```

### **3. Agregar Campos Personalizados a Empleados**
```json
POST /api/CustomFields
{
  "nombre": "Licencias Especiales",
  "descripcion": "Licencias adicionales que posee el conductor",
  "tipo": "Text",
  "entidad": "Usuario",
  "empresaId": 1,
  "requerido": false,
  "orden": 2
}
```

### **4. Crear una Buseta con Campos Personalizados**
```json
POST /api/Busetas
{
  "placa": "ABC123",
  "marca": "Mercedes",
  "modelo": "Sprinter",
  "ano": 2020,
  "capacidad": 15,
  "empresaId": 1
}
```

### **5. Asignar Valores a los Campos Personalizados**
```json
POST /api/CustomFieldValues
{
  "customFieldId": 1,
  "entidad": "Buseta",
  "entidadId": 1,
  "valor": "Interurbana"
}
```

## üîç **Consultas Disponibles**

### **Obtener Campos Personalizados de una Empresa:**
```
GET /api/CustomFields?empresaId=1&entidad=Buseta
```

### **Obtener Valores de Campos Personalizados de una Buseta:**
```
GET /api/Busetas/1/custom-fields
```

### **Obtener Busetas con Campos Personalizados:**
```
GET /api/Busetas?empresaId=1
```

## üí° **Casos de Uso Reales**

### **Empresa de Transporte Escolar:**
- **Campo**: "Capacidad de Sillas Infantiles"
- **Tipo**: Number
- **Valor**: 5

### **Empresa de Transporte de Carga:**
- **Campo**: "Tipo de Carga Permitida"
- **Tipo**: Select
- **Opciones**: "Secos|Refrigerados|Peligrosos|Fragiles"

### **Empresa de Transporte Ejecutivo:**
- **Campo**: "Nivel de Confort"
- **Tipo**: Select
- **Opciones**: "B√°sico|Premium|Lujo"

## üõ†Ô∏è **Implementaci√≥n T√©cnica**

### **Base de Datos:**
- **Tabla `CustomFields`**: Almacena la definici√≥n de campos
- **Tabla `CustomFieldValues`**: Almacena los valores espec√≠ficos
- **Relaciones**: Claves for√°neas a `Empresa` y entidades

### **API Endpoints:**
- **CRUD completo** para campos personalizados
- **CRUD completo** para valores de campos
- **Consultas filtradas** por empresa y entidad
- **Operaciones en lote** para m√∫ltiples campos

### **Validaciones:**
- Campos requeridos seg√∫n configuraci√≥n
- Tipos de datos seg√∫n el tipo de campo
- Opciones v√°lidas para campos de selecci√≥n

## üîÆ **Ventajas del Sistema**

### **Para Empresas:**
‚úÖ **Flexibilidad total** - Agregan los campos que necesitan
‚úÖ **Sin dependencia** - No esperan actualizaciones del software
‚úÖ **Personalizaci√≥n** - Adaptan el sistema a sus procesos

### **Para Desarrolladores:**
‚úÖ **C√≥digo limpio** - No hay campos hardcodeados
‚úÖ **Escalabilidad** - F√°cil agregar nuevos tipos de campos
‚úÖ **Mantenimiento** - Cambios sin tocar el c√≥digo base

## üìã **Ejemplo Completo de Implementaci√≥n**

### **Paso 1: Configurar Empresa**
```bash
# Crear empresa
curl -X POST "http://localhost:5000/api/Empresas" \
  -H "Content-Type: application/json" \
  -d '{"nombre": "Mi Empresa", "nit": "123-456"}'
```

### **Paso 2: Agregar Campo Personalizado**
```bash
# Agregar campo para busetas
curl -X POST "http://localhost:5000/api/CustomFields" \
  -H "Content-Type: application/json" \
  -d '{
    "nombre": "Zona de Operaci√≥n",
    "tipo": "Select",
    "opciones": "Norte|Sur|Este|Oeste",
    "entidad": "Buseta",
    "empresaId": 1,
    "requerido": true
  }'
```

### **Paso 3: Crear Buseta**
```bash
# Crear buseta
curl -X POST "http://localhost:5000/api/Busetas" \
  -H "Content-Type: application/json" \
  -d '{
    "placa": "XYZ789",
    "marca": "Toyota",
    "modelo": "Hiace",
    "ano": 2021,
    "capacidad": 12,
    "empresaId": 1
  }'
```

### **Paso 4: Asignar Valor Personalizado**
```bash
# Asignar zona de operaci√≥n
curl -X POST "http://localhost:5000/api/CustomFieldValues" \
  -H "Content-Type: application/json" \
  -d '{
    "customFieldId": 1,
    "entidad": "Buseta",
    "entidadId": 1,
    "valor": "Norte"
  }'
```

## üéâ **¬°Resultado Final!**

Ahora tienes una buseta con un campo personalizado "Zona de Operaci√≥n" con valor "Norte" que solo existe para tu empresa y que puedes usar en reportes, filtros y consultas.

---

**¬øNecesitas ayuda para implementar alg√∫n caso espec√≠fico?** ¬°El sistema est√° dise√±ado para ser flexible y f√°cil de usar!
